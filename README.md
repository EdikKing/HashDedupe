# 文件去重工具

这是一个用 Go 语言编写的文件去重工具，可以扫描指定目录下的所有文件，识别重复文件，并将重复文件的信息导出到 CSV 文件中。该工具通过计算文件的 MD5 和 SHA256 哈希值来帮助识别重复文件。

## 功能特点

- 扫描指定目录下的所有文件和文件夹
- 收集文件的基本信息（名称、路径、大小、修改时间等）
- 计算文件的 MD5 和 SHA256 哈希值
- 只将重复文件信息导出为 CSV 格式
- 支持递归扫描子目录
- 支持命令行参数配置
- 支持可视化进度条显示
- 实时显示处理速度
- 支持并发扫描，提高处理速度
- 支持文件类型识别（扩展名和MIME类型）
- 支持重复文件自动分组和报告生成
- 支持文件大小自动单位转换（B、KB、MB、GB、TB）

## 使用方法

1. 确保已安装 Go 环境（推荐 Go 1.21 或更高版本）
2. 克隆或下载本项目
3. 在项目目录下运行：
   ```bash
   # 使用默认参数（扫描当前目录，4个工作协程）
   go run main.go

   # 指定要扫描的目录
   go run main.go -dir /path/to/directory

   # 指定输出文件路径
   go run main.go -output result.csv

   # 指定工作协程数量（例如使用8个工作协程）
   go run main.go -workers 8

   # 同时指定多个参数
   go run main.go -dir /path/to/directory -output result.csv -workers 8
   ```

## 命令行参数

- `-dir`: 要扫描的目录路径（默认为当前目录）
- `-output`: 输出CSV文件的路径（默认为 file_info.csv）
- `-workers`: 并发工作协程数量（默认为4）
- `-min-size`: 最小文件大小（MB），默认1MB

## 进度显示

程序运行时会显示以下信息：
- 文件总数统计
- 可视化进度条
- 实时处理速度（文件/秒）
- 最终统计信息（总耗时、平均速度等）
- 重复文件统计信息（重复文件组数和总数）

进度条显示特点：
1. 使用彩色进度条直观显示处理进度
2. 显示已处理文件数和总文件数
3. 实时更新处理速度
4. 支持终端颜色显示
5. 自动适应终端宽度

## CSV 文件格式

### 重复文件信息CSV（file_info.csv）
包含以下列：
- 文件名
- 完整路径
- 大小(字节)
- 大小(可读)
- 修改时间
- 是否目录
- MD5哈希值
- SHA256哈希值
- 扩展名
- MIME类型

注意：此文件只包含重复文件的信息，即至少有一个文件与它具有相同的 MD5 或 SHA256 哈希值的文件。

### 重复文件分组CSV（duplicate_groups.csv）
包含以下列：
- 分组ID
- 哈希类型（MD5或SHA256）
- 哈希值
- 文件数量
- 文件大小(字节)
- 文件大小(可读)
- 文件路径列表

注意：
1. 每个重复文件组占一行
2. 文件路径列表使用换行符分隔多个文件路径
3. 按文件数量降序排序分组
4. 只输出包含重复文件的组（文件数量大于1）

## 文件类型识别

程序通过以下方式识别文件类型：
1. 从文件扩展名获取文件类型
2. 使用 MIME 类型系统识别文件类型
3. 对于目录，扩展名和MIME类型字段将为空
4. 扩展名会被转换为小写格式
5. 如果无法识别MIME类型，该字段将为空

## 重复文件分组

程序通过以下方式识别和分组重复文件：
1. 同时使用MD5和SHA256两种哈希算法
2. 根据哈希值对文件进行分组
3. 生成单独的分组报告文件
4. 按文件数量降序排序分组
5. 只输出包含重复文件的组（文件数量大于1）

## 文件大小显示

程序支持自动转换文件大小单位：
1. 自动选择最合适的单位（B、KB、MB、GB、TB）
2. 保留两位小数
3. 同时显示原始字节数和可读格式
4. 使用 1024 作为单位换算基数
5. 支持最大到 TB 的单位显示

## 文件大小过滤

程序支持设置最小文件大小过滤：
1. 默认过滤掉小于1MB的文件
2. 可以通过 `-min-size` 参数自定义最小文件大小
3. 文件大小单位为MB
4. 支持小数点的MB值（如0.5MB）
5. 过滤在文件扫描阶段进行，提高处理效率

使用示例：
```bash
# 使用默认最小文件大小（1MB）
go run main.go

# 设置最小文件大小为2MB
go run main.go -min-size 2

# 设置最小文件大小为500MB
go run main.go -min-size 500

# 设置最小文件大小为0.5MB
go run main.go -min-size 0.5

# 同时使用多个参数
go run main.go -dir /path/to/directory -min-size 2 -workers 8
```

## 注意事项

- 如果指定的目录不存在，程序会显示错误信息并退出
- 程序会自动跳过当前目录的扫描
- 所有路径信息均使用相对路径
- 对于目录，哈希值字段将为空
- 如果计算某个文件的哈希值失败，程序会继续处理其他文件，并在控制台输出错误信息
- 进度显示会实时更新，使用回车符覆盖当前行
- 并发扫描时，CSV写入操作是线程安全的
- 工作协程数量建议根据CPU核心数和系统资源情况来设置
- 文件类型识别基于文件扩展名和MIME类型系统，可能无法识别某些特殊文件类型
- 重复文件分组报告会保存在与主输出文件相同的目录中
- 程序会自动跳过系统文件夹和隐藏文件夹，包括：
  - 回收站（$RECYCLE.BIN）
  - 系统卷信息（System Volume Information）
  - 恢复分区（Recovery）
  - Windows应用文件夹（WindowsApps）
  - 程序数据文件夹（ProgramData）
  - 系统临时文件夹
  - 用户配置文件文件夹
  - 以点号开头的隐藏文件夹
- 程序会自动跳过小于最小文件大小限制的文件
- 如果遇到无法访问的目录，程序会显示警告信息并跳过该目录，继续处理其他文件 